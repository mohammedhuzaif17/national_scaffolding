{% extends "base.html" %}

{% block title %}National Scaffolding - Products{% endblock %}

{% block content %}
<div class="glass-container">
    <h1 class="page-title">The National Scaffolding</h1>
    <p class="page-subtitle">Professional scaffolding services for all your construction needs</p>
    
    <div class="text-center mb-3">
        <button class="btn btn-secondary" onclick="window.location.href='{{ url_for('fabrications') }}'">
            Go to Fabrications
        </button>
    </div>
    
    <div class="category-buttons">
        <button class="category-btn {% if category == 'all' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='all') }}'">
            ALL PRODUCTS
        </button>
        <button class="category-btn {% if category == 'aluminium' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='aluminium') }}'">
            ALUMINIUM SCAFFOLDINGS
        </button>
        <button class="category-btn {% if category == 'h-frames' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='h-frames') }}'">
            H FRAMES
        </button>
        <button class="category-btn {% if category == 'cuplock' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='cuplock') }}'">
            CUPLOCK
        </button>
        <button class="category-btn {% if category == 'accessories' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='accessories') }}'">
            ACCESSORIES
        </button>
    </div>

    <h2 class="mt-4">Our Products</h2>
    
    <div class="products-grid">
        {% for product in products %}
        <div class="product-card" {% if product.category == 'cuplock' %}style="grid-column: span 2;"{% endif %}>
            <div onclick="window.location.href='{{ url_for('product_detail', product_id=product.id) }}'" style="cursor: pointer;">
                {% if product.image_url %}
                <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-image">
                {% else %}
                <div class="product-image-placeholder">
                    <span>ðŸ“¦</span>
                </div>
                {% endif %}
            </div>
            <div class="product-info">
                <h3 class="product-name" onclick="window.location.href='{{ url_for('product_detail', product_id=product.id) }}'" style="cursor: pointer;">{{ product.name }}</h3>
                <p class="product-description">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                {% if product.category %}
                <p class="product-category">{{ product.category }}</p>
                {% endif %}
                
                {% if product.category != 'cuplock' %}
                <div class="product-price">â‚¹{{ product.price }}</div>
                {% if product.rent_price %}
                <p class="product-rent">Rent: â‚¹{{ product.rent_price }}/month</p>
                {% endif %}
                {% endif %}
                
                {% if product.category != 'cuplock' and current_user.is_authenticated and session.get('user_type') != 'admin' %}
                <div class="form-group" style="margin-top: 1rem;">
                    <label for="quantity_{{ product.id }}">Quantity:</label>
                    <select id="quantity_{{ product.id }}" class="form-control">
                        {% for i in range(1, 11) %}
                        <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="event.stopPropagation(); addToCart({{ product.id }}, '{{ product.name }}', {{ product.price }})" style="flex: 1;">
                        ðŸ›’ Add to Cart
                    </button>
                    <button class="btn btn-secondary" onclick="event.stopPropagation(); window.location.href='{{ url_for('product_detail', product_id=product.id) }}'" style="flex: 1;">
                        View Details
                    </button>
                </div>
                {% else %}
                <button class="btn" onclick="event.stopPropagation(); window.location.href='{{ url_for('product_detail', product_id=product.id) }}'">
                    View Details
                </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% if current_user.is_authenticated and session.get('user_type') != 'admin' %}
<button class="view-cart-btn" onclick="window.location.href='{{ url_for('cart') }}'">
    ðŸ›’ View Cart
</button>
{% endif %}
{% endblock %}

{% block scripts %}
function addToCart(productId, productName, price) {
    const quantity = parseInt(document.getElementById('quantity_' + productId).value);
    
    fetch('/add_to_cart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            product_id: productId,
            product_name: productName,
            price: price,
            quantity: quantity,
            customization: { quantity: quantity }
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('âœ… Product added to cart successfully!');
            // Update cart count if you have a cart icon
        } else {
            showToast('âŒ ' + (data.message || 'Failed to add to cart'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('âŒ Error adding to cart');
    });
}

function showToast(message) {
    // Remove existing toast if any
    const existingToast = document.querySelector('.toast-notification');
    if (existingToast) {
        existingToast.remove();
    }
    
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.innerHTML = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 100);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            if (toast.parentNode) {
                document.body.removeChild(toast);
            }
        }, 300);
    }, 3000);
}
{% endblock %}
