{% extends "base.html" %}

{% block title %}National Scaffolding - Products{% endblock %}

{% block content %}
<div id="welcomePopup" class="welcome-popup">
    <div class="welcome-content">
        <h1>Welcome to 'THE NATIONAL SCAFFOLDING'</h1>
        <p>We don't just build scaffolds â€” we build confidence. Explore quality that supports every great construction.</p>
        <button class="btn-explore" onclick="closeWelcome()">Continue to Explore</button>
    </div>
</div>

<div class="glass-container">
    <h1 class="page-title">The National Scaffolding</h1>
    <p class="page-subtitle">Professional scaffolding services for all your construction needs</p>
    
    <div class="text-center mb-3">
        <button class="btn btn-secondary" onclick="window.location.href='{{ url_for('fabrications') }}'">
            ðŸ”§ Go to Fabrications
        </button>
    </div>
    
    <div class="category-buttons">
        <button class="category-btn {% if category == 'all' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='all') }}'">
            ALL PRODUCTS âœ“
        </button>
        <button class="category-btn {% if category == 'aluminium' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='aluminium') }}'">
            ALUMINIUM SCAFFOLDINGS
        </button>
        <button class="category-btn {% if category == 'h-frames' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='h-frames') }}'">
            H FRAMES
        </button>
        <button class="category-btn {% if category == 'cuplock' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='cuplock') }}'">
            CUPLOCK
        </button>
        <button class="category-btn {% if category == 'accessories' %}active{% endif %}" 
                onclick="window.location.href='{{ url_for('national_scaffoldings', category='accessories') }}'">
            ACCESSORIES
        </button>
    </div>

    <h2 class="mt-4">Our Products</h2>
    
    <div class="products-grid">
        {% for product in products %}
        <div class="product-card" onclick="window.location.href='{{ url_for('product_detail', product_id=product.id) }}'">
            {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
            <div class="product-image-placeholder">
                <span>ðŸ“¦</span>
            </div>
            {% endif %}
            <div class="product-info">
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-description">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                {% if product.category %}
                <p class="product-category">{{ product.category }}</p>
                {% endif %}
                <div class="product-price">â‚¹{{ product.price }}</div>
                {% if product.rent_price %}
                <p class="product-rent">Rent: â‚¹{{ product.rent_price }}/month</p>
                {% endif %}
                
                <button class="btn" onclick="event.stopPropagation(); window.location.href='{{ url_for('product_detail', product_id=product.id) }}'">
                    View Details
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% if current_user.is_authenticated and session.get('user_type') != 'admin' %}
<button class="view-cart-btn" onclick="window.location.href='{{ url_for('cart') }}'">
    ðŸ›’ View Cart
</button>
{% endif %}
{% endblock %}

{% block scripts %}
// Check if welcome popup has been shown this session
window.addEventListener('DOMContentLoaded', () => {
    const popupShown = sessionStorage.getItem('welcomeShown');
    if (popupShown) {
        document.getElementById('welcomePopup').style.display = 'none';
    }
});

function closeWelcome() {
    document.getElementById('welcomePopup').style.display = 'none';
    sessionStorage.setItem('welcomeShown', 'true');
}

function addToCart(productId, productName, price) {
    const quantity = document.getElementById('quantity_' + productId).value;
    
    fetch('/add_to_cart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            product_id: productId,
            product_name: productName,
            price: price,
            quantity: parseInt(quantity)
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Product added to cart!');
        }
    });
}
{% endblock %}
