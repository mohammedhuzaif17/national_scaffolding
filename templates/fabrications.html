{% extends "base.html" %}

{% block title %}National Scaffolding - Fabrications{% endblock %}
{% block content %}

<style>
/* =========================================
   RESET & BASE STYLES
   ========================================= */
* {
    box-sizing: border-box; /* Critical for mobile width calculations */
}

.product-gallery {
    position: relative;
    width: 100%;
    height: 250px;
    overflow: hidden;
    border-radius: 8px 8px 0 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    background: #f0f0f0;
    cursor: pointer;
}

.gallery-images-container {
    position: relative;
    width: 100%;
    height: 100%;
}

.gallery-item {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
    top: 0;
    left: 0;
    pointer-events: none;
}

.gallery-item.active {
    opacity: 1;
    z-index: 1;
    pointer-events: auto;
}

.gallery-item img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
}

.gallery-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(0,0,0,0.7);
    color: white;
    border: 2px solid rgba(255,255,255,0.8);
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    transition: all 0.2s ease;
    user-select: none;
}

.gallery-nav:hover {
    background-color: rgba(0,0,0,0.9);
    transform: translateY(-50%) scale(1.1);
    border-color: white;
}

.gallery-prev { left: 10px; }
.gallery-next { right: 10px; }

.gallery-dots {
    position: absolute;
    bottom: 10px;
    left: 0; right: 0;
    display: flex;
    justify-content: center;
    gap: 8px;
    z-index: 10;
}

.gallery-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    background-color: rgba(255,255,255,0.5);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid rgba(0,0,0,0.3);
}

.gallery-dot.active { background-color: white; transform: scale(1.2); border-color: rgba(0,0,0,0.5); }
.gallery-dot:hover { background-color: rgba(255,255,255,0.8); }

.gallery-counter {
    position: absolute;
    top: 10px; right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    z-index: 10;
}

/* PRODUCT CARD STYLES */
.product-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
}

.product-image-container {
    width: 100%;
    height: 260px; /* Desktop height */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 5px;
    background: #ffffff;
    overflow: hidden;
}

.product-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.3s ease;
    cursor: pointer;
    background-color: #ffffff;
}

.product-image:hover { transform: scale(1.05); }

.product-image-placeholder {
    width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center;
    background: #f0f0f0; font-size: 3rem; cursor: pointer;
}

.product-info {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.product-name {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: #001d3d;
    cursor: pointer;
    transition: color 0.3s ease;
    line-height: 1.3;
}

.product-name:hover { color: #004080; }

.product-category {
    display: inline-block;
    background: #ffd966;
    color: #001d3d;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 1rem;
    text-transform: uppercase;
}

.product-description {
    color: #555;
    margin-bottom: 1rem;
    line-height: 1.5;
    flex: 1;
    font-size: 0.95rem;
}

.product-price-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.product-price {
    font-size: 1.8rem;
    font-weight: 800;
    color: #001d3d;
}

.product-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    font-size: 0.95rem;
}

.btn-primary { background: linear-gradient(135deg, #002855, #004080); color: white; }
.btn-secondary { background: #6c757d; color: white; }

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* PAGE LAYOUT */
.page-container {
    display: block;
    margin: 0 auto;
    max-width: 100%;
    padding: 20px; /* Desktop padding */
}

.page-header {
    text-align: center;
    margin-bottom: 2rem;
}

.page-title {
    font-size: 2.5rem;
    font-weight: 800;
    color: #001d3d;
    margin-bottom: 0.5rem;
}

.page-subtitle {
    color: #555;
    margin-bottom: 2rem;
    font-size: 1.1rem;
}

.category-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.category-btn {
    padding: 0.75rem 1.5rem;
    background: #f8f9fa;
    border: 2px solid #dee2e6;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.category-btn.active { background: #001d3d; color: white; border-color: #001d3d; }

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
}

.view-cart-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: linear-gradient(135deg, #d4af37, #c29d2f);
    color: #001d3d;
    border: none;
    padding: 15px 25px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 0 4px 16px rgba(212,175,55,0.4);
    transition: all 0.3s ease;
    z-index: 999;
    text-decoration: none;
    white-space: nowrap;
}

/* HERO SECTION */
.hero-section {
    position: relative;
    width: 100%;
    min-height: 500px;
    background:url('{{ url_for('static', filename='images/background.png') }}');
    background-size: cover;
    background-position: right center;
    background-attachment: fixed;
    background-repeat: no-repeat;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
    padding: 80px 20px;
    margin-bottom: 40px;
    overflow: hidden;
}

.hero-section::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.5) 100%);
    z-index: 1;
}

.hero-content {
    position: relative;
    z-index: 2;
    max-width: 800px;
    animation: fadeInDown 0.8s ease-out;
    padding: 30px;
    border-radius: 10px;
    background-color: rgba(0, 0, 0, 0.5);
}

.hero-content h1 {
    font-size: 3.5rem;
    font-weight: 900;
    margin-bottom: 1rem;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9);
    letter-spacing: 2px;
}

.hero-content h3 {
    font-size: 1.3rem;
    color: #ffd966;
    margin-bottom: 0.8rem;
    text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.9);
    font-weight: 600;
}

.hero-tagline {
    font-size: 1.1rem;
    color: #ffffff;
    margin: 1.5rem 0;
    line-height: 1.6;
    text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.9);
}

.hero-btn {
    display: inline-block;
    margin-top: 2rem;
    padding: 12px 35px;
    background: linear-gradient(135deg, #ffd966, #d4af37);
    color: #001d3d;
    text-decoration: none;
    border: none;
    border-radius: 50px;
    font-weight: 700;
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
}

.hero-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 28px rgba(212, 175, 55, 0.6);
}

@keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

/* =========================================
   RESPONSIVE MOBILE CSS
   ========================================= */

/* Large Desktops and Laptops */
@media (min-width: 1200px) {
    .page-container {
        max-width: 1140px;
    }
}

/* Tablets and Small Desktops */
@media (max-width: 1024px) {
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }
}

@media (max-width: 768px) {
    .page-container {
        padding: 15px;
    }

    .hero-section {
        min-height: 400px;
        background-attachment: scroll; /* Fixed bg often janky on mobile */
        padding: 40px 15px;
        margin-bottom: 20px;
    }

    .hero-content h1 { font-size: 2.2rem; letter-spacing: 1px; }
    .hero-content h3 { font-size: 1.1rem; }
    .hero-tagline { font-size: 0.95rem; }
    
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    
    .product-image-container {
        height: 220px;
    }
}

/* Mobile Phones */
@media (max-width: 480px) {
    .page-container {
        padding: 10px; /* Reduce padding for more width */
    }

    .page-title {
        font-size: 1.8rem;
    }

    /* Force single column for cleaner look */
    .products-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    /* Reduce image height on mobile to save vertical space */
    .product-image-container {
        height: 200px; 
        padding: 10px;
    }

    .product-info {
        padding: 1rem;
    }

    .product-name {
        font-size: 1.1rem;
    }

    .product-description {
        font-size: 0.9rem;
    }

    .product-price {
        font-size: 1.5rem;
    }

    /* STACK BUTTONS ON MOBILE */
    /* This prevents squishing and makes buttons easier to tap */
    .product-actions {
        flex-direction: column;
        gap: 10px;
        width: 100%;
    }

    .product-actions .btn {
        width: 100%;
        padding: 14px; /* Larger touch target */
        font-size: 1rem;
    }

    /* Floating Cart Button adjustments */
    .view-cart-btn {
        bottom: 15px;
        right: 15px;
        padding: 12px 20px;
        font-size: 1rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
}

/* Very Small Screens (iPhone SE, etc) */
@media (max-width: 360px) {
    .hero-content {
        padding: 15px;
    }
    
    .hero-content h1 {
        font-size: 1.6rem;
    }

    .product-image-container {
        height: 180px;
    }
    
    .product-info {
        padding: 0.8rem;
    }
    
    .product-name {
        font-size: 1rem;
    }
    
    .product-price {
        font-size: 1.3rem;
    }
}

/* =========================================
   NAVIGATION FIX NOTE
   =========================================
   The navigation bar issue is in the base.html file, which is not provided here.
   To fix the disappearing navigation on mobile devices, you need to:
   
   1. In base.html, add a hamburger menu icon that's visible only on mobile
   2. Create a CSS-based dropdown menu that appears when the hamburger is clicked
   3. Ensure the navigation links are properly styled for mobile devices
   
   Here's an example of what you might add to base.html:
   
   HTML:
   <div class="nav-container">
     <div class="nav-header">
       <div class="nav-logo">Your Logo</div>
       <button class="nav-toggle" id="nav-toggle">
         <span class="bar"></span>
         <span class="bar"></span>
         <span class="bar"></span>
       </button>
     </div>
     <nav class="nav-menu" id="nav-menu">
       <!-- Your navigation links here -->
     </nav>
   </div>
   
   CSS (to be added to base.html):
   @media (max-width: 768px) {
     .nav-toggle {
       display: flex;
       flex-direction: column;
       justify-content: space-between;
       width: 30px;
       height: 21px;
       background: transparent;
       border: none;
       cursor: pointer;
       z-index: 1000;
     }
     
     .nav-toggle .bar {
       height: 3px;
       width: 100%;
       background-color: #333;
       border-radius: 10px;
       transition: all 0.3s ease-in-out;
     }
     
     .nav-menu {
       position: fixed;
       left: -100%;
       top: 70px;
       flex-direction: column;
       background-color: #fff;
       width: 100%;
       text-align: center;
       transition: 0.3s;
       box-shadow: 0 10px 27px rgba(0, 0, 0, 0.05);
       padding: 2rem 0;
     }
     
     .nav-menu.active {
       left: 0;
     }
   }
   
   JavaScript (to be added to base.html):
   document.getElementById('nav-toggle').addEventListener('click', function() {
     document.getElementById('nav-menu').classList.toggle('active');
   });
   ========================================= */
</style>

<!-- HERO SECTION WITH BACKGROUND IMAGE -->
<div class="hero-section">
    <div class="hero-content">
        <h1>The National Scaffolding</h1>
        <h3>Since 2015</h3>
        <p class="hero-tagline">"The Wide Range Of Manufacturers In Aluminium, H-Frame And CupLock Scaffolding and Rental Services"</p>
    </div>
</div>

<div class="page-container">
    <header class="page-header">
        <h2 class="page-title">Fabrication Products</h2>
    </header>

    <div style="text-align: center; margin-bottom: 30px;">
        <button class="hero-btn" onclick="window.location.href='{{ url_for('national_scaffoldings') }}'">
            Back to Scaffolding Products
        </button>
    </div>
    
    <!-- FABRICATION CATEGORY FILTERS (Commented out in original, kept here) -->
    <!-- <div class="category-buttons">...</div> -->
    
    <div class="products-grid">
        {% for product in products %}
        <div class="product-card">

            <!-- PRODUCT IMAGE -->
            <div class="product-image-container"
                 onclick="window.location.href='{{ url_for('fabrication_detail', product_id=product.id) }}'">

                {% if product.image_url %}
                    {% set images = product.image_url.split(',') %}
                    <img src="{{ url_for('static', filename=images[0].strip()) }}"
                         class="product-image"
                         alt="{{ product.name }}"
                         onerror="this.src='{{ url_for('static', filename='images/no-image.png') }}'">
                {% else %}
                    <div class="product-image-placeholder">üì¶</div>
                {% endif %}
            </div>

            <!-- PRODUCT INFO -->
            <div class="product-info">

                <h3 class="product-name"
                    onclick="window.location.href='{{ url_for('fabrication_detail', product_id=product.id) }}'">
                    {{ product.name }}
                </h3>

                {% if product.category %}
                <span class="product-category">
                    {{ product.category|replace('-', ' ') }}
                </span>
                {% endif %}

                {% if product.description %}
                <p class="product-description">
                    {{ product.description[:100] }}
                    {% if product.description|length > 100 %}...{% endif %}
                </p>
                {% endif %}

                <!-- PRICE -->
                <div class="product-price-row">
                    <span class="product-price">
                        ‚Çπ{{ "%.2f"|format(product.price|float) }}
                    </span>
                </div>

                <div class="product-actions">
                    <button class="btn btn-secondary"
                            onclick="window.location.href='{{ url_for('fabrication_detail', product_id=product.id) }}'">
                        View Details
                    </button>

                    {% if current_user.is_authenticated and session.get('user_type') != 'admin' %}
                    <button class="btn btn-primary"
                            onclick="addToCart({{ product.id }}, '{{ product.name|e }}')">
                        üõí Add to Cart
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if not products %}
    <div class="alert alert-warning text-center" style="margin: 2rem 0; padding: 1.5rem; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
        <h4>No Fabrication Products Found</h4>
        <p>There are currently no fabrication products available in this category.</p>
    </div>
    {% endif %}
</div>

{% if current_user.is_authenticated and session.get('user_type') != 'admin' %}
<button class="view-cart-btn" onclick="window.location.href='{{ url_for('cart') }}'">
    üõí View Cart
</button>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
function addToCart(productId, productName) {
    fetch('/add_to_cart', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            product_id: productId,
            quantity: 1,
            customization: { product_type: 'fabrication' }
        })
    })
    .then(r => r.json())
    .then(d => {
        if (d.success) {
            alert('‚úÖ ' + productName + ' added to cart');
        } else {
            alert('‚ùå ' + d.message);
        }
    })
    .catch(() => alert('‚ùå Error adding to cart'));
}
</script>
{% endblock %}